<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DaDraw</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #fff;
        }

        canvas {
            display: block;
            width: 100vw;
            height: 100vh;
        }
    </style>
</head>
<body>
<canvas id="canvas"></canvas>
<script src="draw.js"></script>
<script>
    console.log('Script started');
    console.log('Draw function:', draw);

    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    console.log('Canvas context:', ctx);

    // Get device pixel ratio for retina screen support
    const dpr = window.devicePixelRatio || 1;

    // Размеры экрана (используй эти переменные для рисования)
    let width = window.innerWidth;
    let height = window.innerHeight;

    function resizeCanvas() {
        width = window.innerWidth;
        height = window.innerHeight;

        canvas.width = width * dpr;
        canvas.height = height * dpr;
        ctx.setTransform(1, 0, 0, 1, 0, 0); // reset any previous scale
        ctx.scale(dpr, dpr);
    }

    resizeCanvas();
    window.addEventListener('resize', resizeCanvas);

    // ========================================
    // draw here - add your event listeners below for screen 1
    // ========================================

    // Handle click events
    canvas.addEventListener('click', (e) => {
        const rect = canvas.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        handleClick(x, y);
    });

    // Mouse events for drawing
    canvas.addEventListener('mousedown', (e) => {
        const rect = canvas.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;

        // Check slider first
        if (handleSliderStart(x, y)) return;

        startDrawing(x, y);
    });

    canvas.addEventListener('mousemove', (e) => {
        const rect = canvas.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;

        // Handle slider drag
        if (handleSliderMove(x, y)) return;

        continueDrawing(x, y);
    });

    canvas.addEventListener('mouseup', () => {
        handleSliderEnd();
        stopDrawing();
    });

    canvas.addEventListener('mouseleave', () => {
        stopDrawing();
    });

    // Touch events for mobile
    let touchStartTime = 0;
    let touchStartX = 0;
    let touchStartY = 0;

    canvas.addEventListener('touchstart', (e) => {
        e.preventDefault();
        const rect = canvas.getBoundingClientRect();
        const touch = e.touches[0];
        const x = touch.clientX - rect.left;
        const y = touch.clientY - rect.top;

        touchStartTime = Date.now();
        touchStartX = x;
        touchStartY = y;

        // Check slider first
        if (handleSliderStart(x, y)) return;

        // On screen 1, just record the touch for tap detection
        // On screen 2, start drawing
        if (getCurrentScreen() === 2) {
            startDrawing(x, y);
        }
    });

    canvas.addEventListener('touchmove', (e) => {
        e.preventDefault();
        const rect = canvas.getBoundingClientRect();
        const touch = e.touches[0];
        const x = touch.clientX - rect.left;
        const y = touch.clientY - rect.top;

        // Handle slider drag
        if (handleSliderMove(x, y)) return;

        continueDrawing(x, y);
    });

    canvas.addEventListener('touchend', (e) => {
        e.preventDefault();
        const touchDuration = Date.now() - touchStartTime;

        // Handle slider end
        if (handleSliderEnd()) {
            return;
        }

        // If it was a quick tap (less than 300ms) and didn't move much, treat as click
        if (touchDuration < 300) {
            handleClick(touchStartX, touchStartY);
        }

        stopDrawing();
    });

    // Wheel event for zooming
    canvas.addEventListener('wheel', (e) => {
        e.preventDefault();
        const rect = canvas.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        handleZoom(e.deltaY, x, y);
    }, { passive: false });

    // ========================================
    // end of event listeners for screen 2
    // ========================================

    function loop(time) {
        draw(time, ctx, width, height);  // передаём время в функцию рисования
        requestAnimationFrame(loop);
    }

    // Запускаем!
    console.log('Starting animation loop');
    requestAnimationFrame(loop);
</script>
</body>
</html>